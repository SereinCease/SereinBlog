---
title: 接口测试工具笔记
date: 2025-06-11 14:01:57
tags:
categories:
cover:
description:
---





精确断言：
1.在请求之前自定义随机时间，并设置为全局变量

```
var today_time = Date.now();
pm.globals.set("today_time",today_time);
```





```
const sleep = (milliseconds) => {
    const start = Date.now();
    while (Date.now() <= start + milliseconds) {}
};
sleep(3000);
```



```
var md5_username = CryptoJS.MD5("admin").toString();
pm.globals.set("md5_username",md5_username);
```





```
//base64位加密
var a = CryptoJS.enc.Utf8.parse("admin")
var base64_username = CryptoJS.enc.Base64.stringify(a)
var b = CryptoJS.enc.Utf8.parse("123")
var base64_password = CryptoJS.enc.Base64.stringify(b)
pm.globals.set("base64_username",base64_username);
pm.globals.set("base64_password",base64_password);

//base64位解密
var yuanen = CryptoJS.enc.Base64.parse("YWRtaW4=");
var admin_string=yuanen.toString(CryptoJS.enc.Utf8);
console.log(admin_string)
```

## 一、接口自动化基础之pytest框架用法、规则、配置、标记(day13)

### 1.pytest测试框架

#### 安装pytest

```
pip install pytest # 安装pytest
pip install pytest -U # 安装、升级pytest 到最新版
pip install pytest==7.0 # 安装pytest 7.0版本
```

```
pip show pytest # 查看pyetst信息
```

#### 编写测试用例

文件名：`test_*.py` 或 `*_test.py`

函数/方法名：`test_*`

断言：`assert` 语句

#### 执行测试用例

命令行

```
pytest
```

代码，创建run.py

```
import pytest
pytest.main() # 启动测试框架
```

#### 执行结果

| 缩写 | 单词    | 含义                       |
| ---- | ------- | -------------------------- |
| .    | passed  | 通过                       |
| F    | failed  | 失败（用例执行时报错）     |
| E    | error   | 出错（fixture执行报错）    |
| s    | skipped | 跳过                       |
| X    | xpassed | 预期外的通过（不符合预期） |
| x    | xfailed | 预期内的失败（符合预期）   |

#### 用例发现规则

pytest识别、加载测试用例过程称之为用例发现，规则：
1. 遍历所有的目录 （venv除外）
2. 遍历所有 test_ 开头 或者 _test 结尾的python文件
3. 遍历所有 Test 开头的类
  类不能拥有 __init__ 方法
4. 收集 test_ 开头的函数或者方法，作为测试用例
  重点：pytest，只有函数和方法，才被视为测试用例，目录、文件、类，作为用例的容器

###  2.pytest高级用法

#### 配置:命令行参数/ ini配置文件

```
#查看所有的配置项
>pytest -h
usage: pytest [options] [file_or_dir] [file_or_dir] [...]
```

##### 常用的命令行参数

`-v `：增加详细程度
`-q `：减少详细程度
`-s `：不进行内容捕获，才能正常的输入输出
`-x` ：快速退出（冒烟测试）

##### 常用的ini配置项

在根目录创建 pytest.ini 文件

创建 pytest 选择器

按行添加配置项

```python
[pytest]
; 添加命令行参数
addopts = -s -x
```

#### 标记mark

##### 用户自定义

###### 1.注册 pytest.ini

```ini
[pytest]
markers =
	api
	ui
	ut
	e2e
```

###### 2.标记

```python
@pytest.mark.ut
def test_ok():
assert 1 == 1 # 测试通过
```

###### 3.筛选

```cmd
pytest -m api # 只执行拥有api标记的用例
```

支持逻辑运算

```cmd
pytest -m "ui and api" #只执行拥有ut 并且 拥有api标记的用例
```

##### 框架内置标记

- skip：无条件跳过
- skipif：有条件跳过
- xfail：预期失败
- parametrize：参数化： 框架为用例传递参数
- usefixture：使用fixture

参数化测试：通过数据修改参数，从而改变测试用例
数据驱动测试 = 参数化测试 + 数据文件

```python
@pytest.mark.parametrize(
	"a, b, c", # 1. 列出参数
    [ # 2. 准备参数的值
        [1, 1, 2],
        [2, 2, 4],
        [2, 3, 5],
        [3, 3, 6], # 3. 根据需求修改数据
    ]
)
def test_add_1_1(a, b, c):
	assert c == add(a, b)
```

## 二、接口自动化基础之pytest框架fixture、常用插件、Allure报告、企业级定制(day14)

### 1.pytest夹具fixture

夹具：在用例执行之前、执行之后，自动的运行自定义代码

#### 创建夹具

```python
#1. 创建函数
#2. 添加装饰器
#3. yield
@pytest.fixture
def f():
    print('启动浏览器') # 前置操作，用例执行之前，自动执行
    yield '浏览器类型：chrome' # 返回值，供用例使用
    print('关闭浏览器') # 后置操作，用例执行之后，自动执行
```

简便的方式创建fixture

```python
@pytest.fixture
def f(): # 使用fixture
    print('启动浏览器')
    return Non
```

#### 使用夹具

```python
def test_abc(f): # 使用fixture，得到它的返回值
print('我是用例内容，正在执行')
print('收到fixture的返回值:', f)
```

简便的方式使用fixture

```
@pytest.mark.usefixtures('f') # 使用fixture
def test_abc():
print('我是用例内容，正在执行')
```

#### 作用范围-共享

function：默认，不共享
2. class：同一个类中用例，自动共享
3. module：同一个模块（文件）中用例，自动共享
4. package：同一个包（目录）中用例，自动共享
5. session：所有用例，自动共享

```
@pytest.fixture(scope='class')
```

conftest.py
从名字上看：测试配置
从内容上看：python代码
从效果上看：被pytest自动导入，实现跨文件的fixture
每个目录都可以创建一个conftest.py
子目录的conftest.py可以屏蔽父目录的conftest.py
哪个文件里用例更近，它的优先级就越高

### 2.pytest常用插件

[]: https://pypi.org/

#### pytest-html

用途：生成HTML测试报告
文档：https://pytest-html.readthedocs.io/en/latest/installing.html
安装

```
pip install pytest-html
```

配置： 命令行参数

```
--html=report.html --self-contained-html
```

#### pytest-xdist

用途：并发执行用例
文档：https://pytest-xdist.readthedocs.io/en/stable/
安装：

```
pip install pytest-xdist
```

配置

```
-n {0,1,2,3,.....n, auto}
```

注意：

2. 多进程额外增加资源
3. 多进程乱序
4. 多进程竞争资源（-s失效）
5. auto 自动判断进程数（CPU内核数）

#### pytest-order

用途：定义用例的执行顺序
文档：https://pytest-order.readthedocs.io/en/latest/
安装：

```
pip install pytest-order
```



